  <!-- Athena Chat Widget με ChatKit (νέο) -->
  <style>
    #athena-widget {
      position: fixed;
      bottom: 20px;
      right: 22px;
      z-index: 9999;
    }

    #athena-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #ffffff;
      border-radius: 50px;
      padding: 6px 16px 6px 6px;
      box-shadow: 0 4px 22px rgba(0,0,0,0.22);
      cursor: pointer;
      font-family: Arial, sans-serif;
      border: none;
      transition: all 0.25s ease;
    }

    #athena-toggle:hover {
      transform: scale(1.05);
    }

    #athena-toggle img {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #eee;
    }

    #athena-toggle span {
      font-size: 14px;
      color: #333;
      font-weight: 500;
      white-space: nowrap;
    }

    #athena-panel {
      position: fixed;
      bottom: 80px;
      right: 22px;
      width: min(420px, 100vw - 40px);
      max-height: 70vh;
      border-radius: 16px;
      background: #ffffff;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      overflow: hidden;
      z-index: 10000;
    }

    @media (max-width: 600px) {
      #athena-toggle span {
        display: none;
      }
      #athena-toggle {
        padding: 6px;
        border-radius: 50%;
      }
    }
  </style>

  <div id="athena-widget">
    <button
      id="athena-toggle"
      type="button"
      aria-label="Άνοιγμα ψηφιακού βοηθού Αθηνά"
    >
      <img
        src="https://insurance.ildigitalassistant.com/assets/athena.png"
        alt="Athena Assistant"
      />
      <span>Ρωτήστε την Αθηνά — Βοήθεια ασφάλισης</span>
    </button>

    <div id="athena-panel" hidden>
      <openai-chatkit id="athena-chat"></openai-chatkit>
    </div>
  </div>

  <script>
    (function () {
      const panel = document.getElementById("athena-panel");
      const btn = document.getElementById("athena-toggle");
      const chatElement = document.getElementById("athena-chat");

      function toggleAthena() {
        if (!panel) return;
        if (panel.hasAttribute("hidden")) {
          panel.removeAttribute("hidden");
        } else {
          panel.setAttribute("hidden", "true");
        }
      }

      if (btn) {
        btn.addEventListener("click", toggleAthena);
      }

      async function initAthena() {
        if (!chatElement) return;

        try {
          const res = await fetch("/api/chatkit/session", { method: "POST" });
          if (!res.ok) {
            console.error("Failed to create ChatKit session", await res.text());
            return;
          }

          const data = await res.json();
          const client_secret = data && data.client_secret;
          if (!client_secret) {
            console.error("No client_secret returned from /api/chatkit/session");
            return;
          }

          if (window.customElements && customElements.whenDefined) {
            try {
              await customElements.whenDefined("openai-chatkit");
            } catch (e) {
              console.warn("openai-chatkit element not defined yet", e);
            }
          }

          if (typeof chatElement.setOptions === "function") {
            chatElement.setOptions({
              api: {
                async getClientSecret(existing) {
                  if (!existing) return client_secret;
                  return client_secret;
                },
              },
              title: "Athena – IL Digital Insurance Assistant",
              composerPlaceholder: "Γράψε εδώ την ερώτησή σου για την ασφάλιση…",
              locale: "el-GR",
              theme: "light",
            });
          } else {
            console.error("chatElement.setOptions is not a function");
          }
        } catch (err) {
          console.error("Error initialising Athena chat", err);
        }
      }

      // Το script είναι στο τέλος του body, άρα το DOM είναι ήδη φορτωμένο
      initAthena();
    })();
  </script>
  <!-- END Athena Chat Widget -->
