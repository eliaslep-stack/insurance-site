<!doctype html>
<html lang="el">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>IL Insurance — Επικοινωνία</title>
  <link rel="stylesheet" href="/assets/styles.css?v=2">
  <script defer src="/assets/theme.js"></script>

  <style>
    .success-box {
      margin-top: 20px;
      padding: 15px;
      background: #0f3;
      color: #000;
      border-radius: 8px;
      display: none;
    }
  </style>
</head>
<body>

<header class="container">
  <nav class="nav">
    <div class="logo">
      <img src="/assets/logo.svg" alt="Logo">
      <strong>IL Insurance</strong>
    </div>
    <div class="lang">
      <a href="#" onclick="Site.setLang('el')">Ελληνικά</a> |
      <a href="#" onclick="Site.setLang('en')">English</a>
    </div>
  </nav>
</header>

<main class="container">
  <section class="page-hero">
    <h1 class="h1">Επικοινωνία</h1>
    <p class="lead">Στείλτε μας μήνυμα για προσφορά, απορία ή ραντεβού.</p>
  </section>

  <section class="card">
    <h2 class="h2">Στοιχεία επικοινωνίας</h2>
    <p>
      Τηλέφωνο: 6981 963 910 (Viber &amp; WhatsApp διαθέσιμο)<br>
      Email: info@ildigitalassistant.com
    </p>
  </section>

  <section class="card">
    <h2 class="h2">Φόρμα μηνύματος</h2>

    <form id="mailForm" class="form">
      <p>
        <label>Ονοματεπώνυμο<br>
          <input type="text" id="name" required>
        </label>
      </p>

      <p>
        <label>Email<br>
          <input type="email" id="email" required>
        </label>
      </p>

      <p>
        <label>Τηλέφωνο<br>
          <input type="tel" id="phone">
        </label>
      </p>

      <p>
        <label>Μήνυμα<br>
          <textarea id="message" rows="5" required></textarea>
        </label>
      </p>

      <p><button class="btn" type="submit">Αποστολή</button></p>
    </form>

    <div id="success" class="success-box">
      ✔ Το μήνυμα δημιουργήθηκε. Ελέγξτε το email σας και πατήστε “Αποστολή”.
    </div>
  </section>
</main>

<footer class="container" style="margin-top:40px;">
  <div>© <span id="year"></span> IL Insurance — Άδεια διαμεσολάβησης [357092]</div>
  <div><a href="./privacy.html">Απόρρητο</a> · <a href="./cookies.html">Cookies</a> · <a href="./terms.html">Όροι</a></div>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</footer>

<script>
  document.getElementById("mailForm").addEventListener("submit", function(e) {
    e.preventDefault(); // Μην κάνει submit

    const name = document.getElementById("name").value;
    const email = document.getElementById("email").value;
    const phone = document.getElementById("phone").value;
    const message = document.getElementById("message").value;

    const mailto = `mailto:info@ildigitalassistant.com?subject=Μήνυμα από ${name}&body= Όνομα: ${name}%0AEmail: ${email}%0AΤηλέφωνο: ${phone}%0A%0AΜήνυμα:%0A${message}`;

    window.open(mailto, "_blank");

    document.getElementById("success").style.display = "block";
  });
</script>

<!-- Athena Floating Chat Widget -->
<style>
  #athena-floating {
    position: fixed;
    bottom: 20px;
    right: 22px;
    z-index: 99999;
  }

  #athena-btn {
    background: #fff;
    border-radius: 50px;
    padding: 6px 14px 6px 6px;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 4px 22px rgba(0,0,0,0.25);
    cursor: pointer;
    border: none;
    transition: all .25s ease;
  }
  #athena-btn:hover { transform: scale(1.05); }

  #athena-btn img {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    object-fit: cover;
  }

  #athena-chatbox {
    position: fixed;
    bottom: 80px;
    right: 20px;
    width: 360px;
    max-height: 520px;
    background: white;
    border-radius: 14px;
    box-shadow: 0 8px 28px rgba(0,0,0,0.3);
    display: none;
    overflow: hidden;
    z-index: 100000;
  }

  #athena-header {
    background: #00a8ff;
    color: white;
    padding: 12px;
    text-align: center;
    font-weight: bold;
  }

  #athena-body {
    padding: 12px;
    height: 360px;
    overflow-y: auto;
    background: #f7f7f7;
    font-size: 14px;
  }

  #athena-inputbox {
    display: flex;
    border-top: 1px solid #ddd;
  }

  #athena-text {
    flex: 1;
    padding: 10px;
    border: none;
    outline: none;
    font-size: 14px;
  }

  #athena-send {
    background: #00a8ff;
    color: white;
    border: none;
    padding: 10px 14px;
    cursor: pointer;
  }
</style>

<div id="athena-floating">
  <button id="athena-btn" type="button">
    <img src="https://insurance.ildigitalassistant.com/assets/athena.png" alt="Αθηνά">
    <span style="font-size:14px;color:#333;font-weight:500;">Μίλα με την Αθηνά</span>
  </button>
</div>

<div id="athena-chatbox">
  <div id="athena-header">Αθηνά — Ψηφιακή Βοηθός</div>
  <div id="athena-body"></div>
  <div id="athena-inputbox">
    <input id="athena-text" type="text" placeholder="Γράψε την ερώτησή σου...">
    <button id="athena-send">➤</button>
  </div>
</div>

<script>
  const bubble = document.getElementById("athena-btn");
  const box = document.getElementById("athena-chatbox");
  const bodyDiv = document.getElementById("athena-body");
  const txt = document.getElementById("athena-text");
  const sendBtn = document.getElementById("athena-send");

  bubble.onclick = () => {
    box.style.display = box.style.display === "block" ? "none" : "block";
  };

  function athenaAdd(sender, text) {
    const div = document.createElement("div");
    div.innerHTML = "<strong>" + sender + ":</strong> " + text;
    div.style.marginBottom = "6px";
    bodyDiv.appendChild(div);
    bodyDiv.scrollTop = bodyDiv.scrollHeight;
  }

  // αρχικό μήνυμα
  athenaAdd("Αθηνά", "Γεια σου! Πες μου τι θέλεις να μάθεις για την ασφάλιση.");

  async function sendAthena() {
    const msg = txt.value.trim();
    if (!msg) return;

    athenaAdd("Εσύ", msg);
    txt.value = "";
    athenaAdd("Αθηνά", "⏳ Σκέφτομαι…");

    try {
      const response = await fetch("/functions/athena", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: msg })
      });

      const data = await response.json();
      bodyDiv.lastChild.remove(); // αφαιρούμε το "Σκέφτομαι…"

      if (data.reply) athenaAdd("Αθηνά", data.reply);
      else if (data.error) athenaAdd("Αθηνά", "Σφάλμα: " + data.error);
      else athenaAdd("Αθηνά", "Σφάλμα ή άδειο μήνυμα.");
    } catch (e) {
      bodyDiv.lastChild.remove();
      athenaAdd("Αθηνά", "Πρόβλημα σύνδεσης. Προσπάθησε ξανά σε λίγο.");
    }
  }

  sendBtn.onclick = sendAthena;
  txt.addEventListener("keypress", e => {
    if (e.key === "Enter") {
      e.preventDefault();
      sendAthena();
    }
  });
</script>

</body>
</html>
